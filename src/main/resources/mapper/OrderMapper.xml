<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zhongjian.webserver.mapper.OrderMapper">
	<select id="getUserOrderStatus" resultType="java.lang.Integer">
		SELECT COUNT(1) FROM
		tb_orderhead WHERE UserId = #{userId} AND CurStatus = -1
		UNION ALL
		SELECT COUNT(1) FROM tb_orderhead WHERE UserId = #{userId} AND
		CurStatus = 0
		UNION ALL
		SELECT COUNT(1) FROM tb_orderhead WHERE UserId =
		#{userId} AND CurStatus = 1
		UNION ALL
		SELECT COUNT(1) FROM tb_orderhead
		WHERE UserId = #{userId} AND CurStatus = 2
	</select>
	<select id="getSpecElecNumById" resultType="java.lang.Integer">
		SELECT ElecNum from
		tb_productspec where Id = #{SpecId}
	</select>
	<select id="getDetailsFormorderheadC" resultType="java.util.Map">
		SELECT
		TolAmount,OrderNoC from tb_orderheadcolleciton where OrderNoCName =
		#{orderNoCName};
	</select>
	<select id="getNeedSubDetailsOfOrderHead" resultType="java.util.Map">
		SELECT
		UserId,UseElecNum,UseCoupon,UsePointNum,UseVIPRemainNum from
		tb_orderhead where OrderNo =
		#{orderNo};
	</select>
	<insert id="insertOrderHead" useGeneratedKeys="true"
		keyProperty="id" parameterType="com.zhongjian.webserver.dto.OrderHeadDto">
		INSERT INTO
		tb_orderhead
		(OrderNo,CreateTime,UserId,TotalAmount,UseElecNum,UseCoupon,UsePointNum,UseVIPRemainNum,Freight,RealPay,ProvinceId,CityId,RegionId,Address,ReceiverName,ReceiverPhone,CurStatus,Memo,ProducerNo,Producertel,ProducerName)
		VALUES
		(#{orderNo},#{createTime,jdbcType=TIMESTAMP},#{userId},#{totalAmount},#{useElecNum},#{useCoupon},#{usePointNum},#{useVIPRemainNum},#{freight},#{realPay},#{provinceId},#{cityId},#{regionId},#{address},#{receiverName},#{receiverPhone},-1,#{memo},#{producerno},#{producertel},#{producername})
	</insert>
	<insert id="insertOrderLine" parameterType="com.zhongjian.webserver.dto.OrderLineDto">
		INSERT INTO
		tb_orderline
		(OrderId,ProductName,SpecName,ProductNum,Price,Amount)
		VALUES
		(#{orderId},#{productName},#{specName},#{productNum},#{price},#{amount})
	</insert>
	<update id="updateOrderHeadScore" parameterType="java.lang.Integer">
		UPDATE
		tb_orderhead SET Score = #{Score} WHERE Id = #{Id}
	</update>
	<insert id="insertOrderHeadCo">
		INSERT INTO tb_orderHeadColleciton
		(OrderNoCName,OrderNoC,TolAmount,CurStatus,CreateTime,UserId) VALUES
		(#{orderNoCName},#{orderNoC},#{tolAmount,jdbcType=DECIMAL},0,#{curTime},#{UserId})
	</insert>
	<update id="updateOrderHeadCoCur">
		UPDATE tb_orderHeadColleciton set CurStatus = 1 WHERE
		CurStatus = 0
	</update>
	<update id="updateOrderHeadStatusToWP">
		UPDATE tb_orderhead set CurStatus = 0 WHERE
		CurStatus
		= -1 and OrderNo = #{OrderNo}
	</update>
	<update id="updateOrderHeadStatus">
		UPDATE tb_orderhead set CurStatus = #{CurStatus} and
		OrderNo = #{OrderNo}
	</update>
	<insert id="insertPreSubQuata">
		INSERT INTO tb_preorderuse
		(UserId,PreUseCoupon,PreUseElec,PreUsePoints,PreUseVipremain,ExpireTime)
		VALUES
		(#{UserId},#{PreUseCoupon},#{PreUseElec},#{PreUsePoints},#{PreUseVipremain},#{ExpireTime})
	</insert>
	<select id="getUserIdByOrderC" resultType="java.lang.String">
		SELECT UserId from
		tb_orderheadcolleciton WHERE OrderNoCName = #{OrderNoCName}
	</select>
</mapper>